<%- include('../partials/header') %>

<% if(user) { %>

  <h1> <%= user.name %>'s Grails</h1> 
  <figure class="image is-64x64">
      <img src="<%= user.avatar %>" alt="Image" />
  </figure>
  <div id="user-grails-main-container">
      <% userCards.forEach(userCard => { %>
        
			<div id="grail-card" style="width: 48%; margin: 5px;" class="box">
				<article class="media">
					<div class="media-left">
					</div>
					<div class="media-content">
						<div class="content">
							<div class="user-grail-content">
								<strong><%= userCard.category %></strong>
								<small>@<%= userCard.user %></small>
								<br />
								<ol type="I" id="ol">
									<% userCard.grails.forEach(grail => { %>
                  <li>
                    <span id="<%= grail._id %>" class="user-grail-text"><%= grail.grail %></span>
                    <span id="<%= grail._id %>" class="user-grail-form" style="display:none">
                    <form id="user-grail-update" action="" onsubmit="return false;">
                      <div class="field is-grouped">
                      <input id="<%= grail._id %>-input" class="input is-small" type="text" name="grail" placeholder="Grail" list="grails" category="<%= userCard.category %>" required/>
                      <datalist id="grails">
                        <% grails.forEach(grail => { %>
                          <option value="<%= grail.grail %>" id="<%= grail._id %>" >
                        <% }) %>
                      </datalist>
                      <button style="display:inline-block" onclick="userGrailUpdate('<%= grail._id %>','<%= userCard.category %>');" type="submit">Save</button>
                    </div>
                    </form>
                  </span>
                    <button id="<%= grail._id %>" class="pencil">Edit</button>

                    <span id="<%= grail._id %>" class="user-grail-delete">
                      <form class="user-grail-buttons" action="/user/grail/<%= grail._id %>/?_method=DELETE" method="POST">
                        <button type="submit"><i class="fas fa-times"></i></button>
                      </form>
                    </span>
                  </li>
									<% }) %>
                </ol>
                
                <form action="/user/grails/<%= userCard.categoryId %>/?_method=DELETE" method="POST">
                  <button class="delete-button button is-danger" type="submit">Delete</button>
                </form>

							</div>
						</div>
						<nav class="level is-mobile, icons">
							<div class="level-left">
								<a class="level-item" aria-label="like">
									<span class="icon is-small">
										<i class="fas fa-heart" aria-hidden="true"></i>
									</span>
								</a>
							</div>
						</nav>
					</div>
				</article>
      </div>
    
			<% }) %>
    </div>

    <% } else { %>
      <% window.location.href='/grails/' %>
    <% } %>

    <%- include('../partials/footer') %>